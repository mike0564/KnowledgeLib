# C
![](./images/c_logo.png)
## C语言

C是一种通用的编程语言，广泛用于系统软件与应用软件的开发。于1969年至1973年间，为了移植与开发UNIX操作系统，由丹尼斯·里奇与肯·汤普逊，以B语言为基础，在贝尔实验室设计、开发出来。

C语言具有高效、灵活、功能丰富、表达力强和较高的可移植性等特点，在程序设计中备受青睐，成为最近25年使用最为广泛的编程语言。当前，C语言编译器普遍存在于各种不同的操作系统中，例如Microsoft Windows、macOS、Linux、Unix等。C语言的设计影响了众多后来的编程语言，例如C++、Objective-C、Java、C#等。

二十世纪八十年代，为了避免各开发厂商用的C语言的语法产生差异，由美国国家标准局为C语言订定了一套完整的国际标准语法，称为ANSI C，作为C语言的标准。二十世纪八十年代至今的有关程序开发工具，一般都支持符合ANSI C的语法。

C语言设计目标是提供一种能以简易的方式编译、处理低级存储器、产生少量的机器代码以及不需要任何运行环境支持便能运行的编程语言。C语言也很适合搭配汇编语言来使用。尽管C语言提供许多低级处理的功能，但仍保持良好跨平台的特性，以一个标准规格写出的C语言程序可在许多电脑平台上进行编译，甚至包含一些嵌入式处理器（微控制器或称MCU）以及超级电脑等作业平台。

## 特性

- C语言是一个有结构化程序设计、具有变量作用域（variable scope）以及递归功能的过程式语言。
- C语言传递参数均是以值传递（pass by value）[3]，另外也可以传递指针（a pointer passed by value）。
- 不同的变量类型可以用结构体（struct）组合在一起。
- 只有32个保留字（reserved keywords），使变量、函数命名有更多弹性。
- 部分的变量类型可以转换，例如整型和字符型变量。
- 透过指针（pointer），C语言可以容易的对存储器进行低级控制。
- 编译预处理（preprocessor）让C语言的编译更具有弹性。

## C语言中的运算符号
|符号|含义|
|---|----|
|()、 []、 -> 、 .、 !、 ++、 --  	|圆括号、方括号、指针、成员、逻辑非、自加、自减|
|++ 、 -- 、 * 、 & 、 ~ 、 ! 、 + 、 - 、 sizeof、(cast) 	|单目运算符|
|* 、 / 、 %、==	|算术运算符|
|+ 、 - 	|算术运算符|
|<< 、 >>	|位运算符|
|< 、 <= 、 > 、 >=	|关系运算符|
|== 、 !=	|关系运算符号|
|&	|位与|
|^	|位异或|
|\|	|位或|
|&&	|逻辑与|
|\|\|	|逻辑或|
|? :	|条件运算符|
|= 、 += 、 -= 、 *= 、 /= 、 %= 、 &= 、 \|= 、 ^=	|赋值运算符|
|,	|顺序运算符|

比较特别的是，比特右移（>>）运算符可以是算术（左端补最高有效位）或是逻辑（左端补 0）位移。例如，将 11100011 右移 3 比特，算术右移后成为 11111100，逻辑右移则为 00011100。因算术比特右移较适于处理带负号整数，所以几乎所有的编译器都是算术比特右移。

运算符的优先级从高到低大致是：单目运算符、算术运算符、关系运算符、逻辑运算符、条件运算符、赋值运算符（=）和逗号运算符。

## 安全性

|符号	|安全性	|符号	|安全性	|符号	|安全性	|符号	|安全性|
|-------|-------|-------|-------|-------|-------|-------|-----|
|+	|溢出,包裹,循环	|-=	|溢出,包裹,循环,截裁	|>>	|无	|>=	|无|
|-	|溢出,包裹,循环	|*=	|溢出,包裹,循环,截裁	|&	|无	|==	|无|
|*	|溢出,包裹,循环	|/=	|溢出,截裁	|~	|无	|!=	|无|||
|%	|溢出	|<<=	|溢出,包裹,循环,截裁	|!	|无	|&&	|无|||
|++	|	|>>=	|截裁	|un+	|无	|\|\|	|无|||
|--	|	|&=	|截裁	|un-	|溢出,包裹,截裁|	?:	|无|||
|=|		|\|=	|截裁|<	|无	|||	
|+=|		|<<|	溢出,包裹,截裁|	>	|无	|||	

### 基础数据类型

|关键字	|位长(字节)	|范围	|格式化字符串|
|-------|----------|-------|-----------|
|char	|1 bytes	|-128..127（或0..255，与体系结构相关）|	%c|
|unsigned char	|1bytes	|0..255	|%c, %hhu|
|signed char	|1bytes	|-128..127	|%c, %hhd, %hhi|
|int	|2bytes(16位系统) 或4bytes|	-32768..32767 或-2147483648..2147483647	|%i, %d|
|unsigned int	|2bytes 或 4 bytes	|0..65535 或0..4294967295	|%u|
|signed int	|2bytes 或4bytes|	-32768..32767 或-2147483648..2147483647	|%i, %d|
|short int	|2bytes	|-32768..32767	|%hi, %hd|
|unsigned short	|2 bytes|	0..65535	|%hu|
|signed short	|2bytes	|-32768..32767	|%hi, %hd|
|long int	|4bytes 或8bytes|	-2147483648..2147483647 或-9223372036854775808..9223372036854775807	|%li, %ld|
|unsigned long	|4bytes 或8 bytes	|0..4294967295 或0..18446744073709551615|	%lu|
|signed long	|4 bytes或8bytes|	-2147483648..2147483647 或-9223372036854775808..9223372036854775807	|%li, %ld|
|long long	|8bytes|	-9223372036854775808..9223372036854775807	|%lli, %lld|
|unsigned long long|	8bytes	|0..18446744073709551615	|%llu|
|float|	4bytes	|2.939x10−38..3.403x10+38 (7 sf)|	%f, %e, %g|
|double|	8bytes|	5.563x10−309..1.798x10+308 (15 sf)|	%lf, %e, %g|
|long double|	10bytes或16bytes|	7.065x10-9865..1.415x109864 (18 sf或33 sf)|	%Lf, %Le, %Lg|

## 内存管理

C语言的特色之一是：程序员必须亲自处理内存的分配细节。

C语言使用栈（Stack）来保存函数返回地址／栈帧基址、完成函数的参数传递和函数局部变量的存储。 如果程序需要在运行的过程中动态分配内存，可以利用堆（Heap）来实现。

基本上C程序的元素存储在内存的时候有3种分配策略：

### 静态分配

如果一个变量声明为全局变量或者是函数的静态变量，这个变量的存储将使用静态分配方式。静态分配的内存一般会被编译器放在数据段或代码段来存储，具体取决于实现。这样做的前提是，在编译时就必须确定变量的大小。 以IA32的x86平台及gcc编译器为例，全局及静态变量放在数据段的低端；全局及静态常量放在代码段的高端。

### 自动分配

函数的自动局部变量应该随着函数的返回会自动释放（失效），这个要求在一般的体系中都是利用栈（Stack）来满足的。相比于静态分配，这时候，就不必绝对要求这个变量在编译时就必须确定变量的大小，运行时才决定也不迟，但是C89仍然要求在编译时就要确定，而C99放松了这个限制。但无论是C89还是C99，都不允许一个已经分配的自动变量运行时改变大小。

所以说**C函数永远不应该返回一个局部变量的地址**。

要指出的是，自动分配也属于动态分配，甚至可以用alloca函数来像分配堆（Heap）一样进行分配，而且释放是自动的。

### 动态分配

还有一种更加特殊的情况，变量的大小在运行时有可能改变，或者虽然单个变量大小不变，变量的数目却有很大弹性，不能静态分配或者自动分配，这时候可以使用堆（Heap）来满足要求。ANSI C定义的堆操作函数是malloc、calloc、realloc和free。

使用堆（Heap）内存将带来额外的开销和风险。

## 安全问题

C语言的特色之一是：语言不负责内存边界检查。此特性容易导致缓冲区溢出问题。

## 工具软件

工具软件可以帮助程序设计者避免一些程序中潜藏或容易出现的问题，例如常会造成程序未预期动作或是运行期错误的代码。

许多语言都有自动源代码检查及审计工具，C语言也有类似工具，像是Lint。可以在程序刚写好时用Lint找出可能有问题的程序，通过Lint后再用C编译器进行编译，许多编译器也可以设置是否要针对一些可能有问题的代码提出警告。MISRA C是一套针对嵌入式系统的法则，可主要也是避免一些可能有问题的代码。

也有一些编译器、程序库或操作系统可以处理一些非标准C语言的功能，例如边界值检查、缓存溢出侦测、序列化及自动垃圾回收功能。

使用像Valgrind或IBM Rational Purify等软件工具，或者链接有特别malloc函数的程序库，有助于找出一些运行期存储器使用的问题。

## 保留关键字

以下是C语言的保留关键字：

|||||
|---|----|----|----|
|char|	short|	int|	unsigned|
|long|	float|	double|	struct|
|union|	void|	enum|	signed|
|const|	volatile|	typedef|	auto|
|register|	static|	extern|	break|
|case|	continue|	default|	do|
|else|	for|	goto|	if|
|return|	switch|	while|	sizeof|

C99新增关键字

_Bool	_Complex	_Imaginary	inline	restrict

C11新增关键字

_Alignas	_Alignof	_Atomic	_Generic	_Noreturn   _Static_assert	_Thread_local